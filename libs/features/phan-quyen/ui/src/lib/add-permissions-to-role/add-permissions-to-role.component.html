<div class="search-backdrop permissions"
     (click)="onToggleSearchAdvanced()"></div>
<div class="m-portlet m-portlet--mobile mb-0">
    <div class="m-portlet__head d-flex align-items-center">
        <div class="m-search-body">
            <div class="search-body--wapper">
                <input type="text"
                       class="ui-input--search"
                       [placeholder]="'LB.SEARCH_PLACEHOLDER' | translate"
                       [(ngModel)]="modelSearch.keyword"
                       (change)="onSearchChange()"
                       (keydown.enter)="onSearchChange()" />
                <span class="m-input-icon__icon m-input-icon__icon--right">
                    <span class="line"></span>
                    <button class="ui-button-search"
                            (click)="onSearchChange()">
                        {{ 'BTN.SEARCH' | translate }}
                    </button>
                    <span class="search-advance"
                          (click)="onToggleSearchAdvanced()">
                        <i class="fa fa-sliders"
                           aria-hidden="true"></i>
                    </span>
                </span>
                <div id="myDropdown"
                     class="dropdown-content-search-advance"
                     style="width: 60%; min-width: 500px"
                     [ngClass]="this.isSearchAdvanced ? 'show-search-advance' : ''"
                     *ngIf="isSearchFirsttime">
                    <div class="custom-search-advance m-form">
                        <div class="form-group m-form__group row">
                            <label class="col-lg-2 col-form-label">{{ 'LB.HRM.MA_NHAN_SU' | translate }} </label>
                            <div class="col-lg-4">
                                <input type="text"
                                       class="m-input form-control custom-input"
                                       [placeholder]="'LB.HRM.MA_NHAN_SU' | translate"
                                       [(ngModel)]="modelSearch.maNhanSu" />
                            </div>
                            <label class="col-lg-2 col-form-label"> {{ 'LB.HRM.HO_TEN' | translate }} </label>
                            <div class="col-lg-4">
                                <input type="text"
                                       class="m-input form-control custom-input"
                                       [placeholder]="'LB.HRM.HO_TEN' | translate"
                                       [(ngModel)]="modelSearch.hoTen" />
                            </div>
                        </div>
                        <div class="form-group m-form__group row">
                            <label class="col-lg-2 col-form-label">{{ 'LB.HRM.NGAY_SINH' | translate }} </label>
                            <div class="col-lg-4">
                                <nz-date-picker [(ngModel)]="modelSearch.ngaySinh"
                                                nzFormat="dd/MM/yyyy"
                                                [nzPlaceHolder]="'LB.SELECT' | translate"
                                                style="width: 100%">
                                </nz-date-picker>
                            </div>
                            <label class="col-lg-2 col-form-label"> {{ 'LB.HRM.GIOI_TINH' | translate }} </label>
                            <div class="col-lg-4"> 
                            </div>
                        </div>
                        <div class="form-group m-form__group row">
                            <label class="col-lg-2 col-form-label"> {{ 'LB.HRM.SO_DIEN_THOAI' | translate }} </label>
                            <div class="col-lg-4">
                                <input type="text"
                                       class="m-input form-control custom-input"
                                       placeholder="Số điện thoại"
                                       [(ngModel)]="modelSearch.soDienThoai" />
                            </div>
                            <label class="col-lg-2 col-form-label"> {{ 'LB.HRM.LOAI_NHAN_SU' | translate }} </label>
                            <div class="col-lg-4"> 
                            </div>
                        </div>
                        <div class="form-group m-form__group row">
                            <label class="col-lg-2 col-form-label"> {{ 'LB.HRM.LOAI_HOP_DONG' | translate }} </label>
                            <div class="col-lg-4"> 
                            </div>
                            <label class="col-lg-2 col-form-label"> {{ 'LB.HRM.CHUC_VU' | translate }} </label>
                            <div class="col-lg-4"> 
                            </div>
                        </div>
                        <div class="form-group m-form__group row">
                            <label class="col-lg-2 col-form-label">
                                {{ 'LB.HRM.CHUC_DANH_KHOA_HOC' | translate }}
                            </label>
                            <div class="col-lg-4"> 
                            </div>
                            <label class="col-lg-2 col-form-label"> {{ 'LB.HRM.NGACH_CONG_CHUC' | translate }} </label>
                            <div class="col-lg-4"> 
                            </div>
                        </div>
                        <div class="form-group m-form__group row">
                            <label class="col-lg-2 col-form-label"> {{ 'LB.HRM.QUOC_TICH' | translate }} </label>
                            <div class="col-lg-4"> 
                            </div>
                            <label class="col-lg-2 col-form-label"> {{ 'LB.HRM.DAN_TOC' | translate }} </label>
                            <div class="col-lg-4"> 
                            </div>
                        </div>
                        <div class="form-group m-form__group row">
                            <label class="col-lg-2 col-form-label"> {{ 'LB.HRM.TON_GIAO' | translate }} </label>
                            <div class="col-lg-4"> 
                            </div>
                            <label class="col-lg-2 col-form-label">
                                {{ 'LB.HRM.CO_QUAN' | translate }}
                            </label>
                            <div class="col-lg-4">
                                <!-- <select-department-tree [placeholder]="'LB.HRM.CO_QUAN' | translate"
                                                        [(ngModel)]="modelSearch.coQuanId" [isCheckStrictly]="true">
                                </select-department-tree> -->
                            </div>
                        </div>
                        <div class="form-group m-form__group row">
                            <label class="col-lg-2 col-form-label">
                                {{ 'LB.HRM.NHOM_QUYEN' | translate }}
                            </label>
                            <div class="col-lg-10">
                                <!-- <select-roles-tree isDisabledParentNode="true"
                                                   [placeholder]="'LB.HRM.CHON_NHOM_QUYEN' | translate"
                                                   [(ngModel)]="modelSearch.idsGroupPermission">
                                </select-roles-tree> -->
                            </div>
                        </div>
                        <div class="form-group m-form__group row text-right">
                            <div class="col-12 text-right">
                                <div class="btn-actions">
                                    <button class="ui-button ui-button-primary mr-2"
                                            (click)="onSearchChange()">
                                        <span class="ui-text">
                                            {{ 'BTN.SEARCH' | translate }}
                                        </span>
                                    </button>
                                    <button class="ui-button ui-button-clear"
                                            (click)="refreshHandler()">
                                        <span class="ui-text">
                                            {{ 'BTN.RESET' | translate }}
                                        </span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="custom-search-adv d-flex align-items-center">
                    <div>
                        <nz-select nzShowSearch
                                   [nzPlaceHolder]="'LB.SELECT' | translate"
                                   nzAllowClear
                                   [(ngModel)]="modelSearch.isPhanQuyen">
                            <nz-option [nzLabel]="'LB.HRM.DA_PHAN_QUYEN' | translate"
                                       [nzValue]="true"> </nz-option>
                            <nz-option [nzLabel]="'LB.HRM.CHUA_PHAN_QUYEN' | translate"
                                       [nzValue]="false"> </nz-option>
                        </nz-select>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="m-portlet__body">
        <kendo-splitter orientation="horizontal"
                        style="height: 100%">
            <kendo-splitter-pane size="70%">
                <div class="grid-wrapper grid-init"
                     [ngStyle]="{ 'height.px': pageHeight }">
                    <kendo-grid [data]="listPhanQuyen" 
                                [loading]="isLoading"
                                [pageSize]="gridState.take!"
                                [skip]="gridState.skip!"
                                [pageable]="pageConfig"
                                [resizable]="true"
                                [columnMenu]="true"
                                [sortable]="true"
                                [selectable]="true"
                                kendoGridSelectBy="idUser"
                                [selectedKeys]="selectionIds"
                                [sort]="gridState.sort!"
                                [style.height]="'100%'"
                                (dataStateChange)="onStateChange($event)">
                        <kendo-grid-checkbox-column [showSelectAll]="true"
                                                    [width]="45"
                                                    [columnMenu]="false"
                                                    class="text-center"
                                                    headerClass="text-center">
                        </kendo-grid-checkbox-column>
                        <kendo-grid-column [title]="'LB.STT' | translate"
                                           [width]="50"
                                           [columnMenu]="false"
                                           headerClass="text-center">
                            <ng-template kendoGridCellTemplate
                                         let-dataItem
                                         let-rowIndex="rowIndex">
                                <div class="text-center">
                                    {{ rowIndex + 1 }}
                                </div>
                            </ng-template>
                        </kendo-grid-column>
                        <kendo-grid-column [columnMenu]="false"
                                           field="maNhanSu"
                                           [title]="'LB.STAFF_CODE' | translate"
                                           [width]="100">
                        </kendo-grid-column>
                        <kendo-grid-column [columnMenu]="false"
                                           field="userName"
                                           [title]="'LB.USERNAME' | translate"
                                           [width]="100">
                        </kendo-grid-column>
                        <kendo-grid-column field="ten"
                                           class="text-left"
                                           [title]="'LB.FULLNAME' | translate"
                                           [width]="150"
                                           [columnMenu]="false">
                            <ng-template kendoGridCellTemplate
                                         let-dataItem>
                                <div class="dark">
                                    <b>{{ dataItem.hoDem + ' ' + dataItem.ten }}</b>
                                </div>
                                <div class="grid-size12">
                                    {{
                                    (dataItem.tenChucVu ? dataItem.tenChucVu : '') +
                                    (dataItem.tenChucVu && dataItem.tenChucDanh ? ' - ' : '') +
                                    (dataItem.tenChucDanh ? dataItem.tenChucDanh : '')
                                    }}
                                </div>
                            </ng-template>
                        </kendo-grid-column>
                        <kendo-grid-column [columnMenu]="false"
                                           field="tenCoQuan"
                                           [title]="'LB.DEPARTMENT' | translate"
                                           [width]="250"
                                           [sortable]="false">
                        </kendo-grid-column>
                        <kendo-grid-column [columnMenu]="false"
                                           field="groupPemission"
                                           [title]="'' | translate"
                                           [sortable]="false"
                                           [width]="120">
                            <ng-template kendoGridCellTemplate
                                         let-dataItem>
                                <div class="text-center">
                                    <div *ngIf="dataItem.groupPemissions; else block">
                                        <span class="label_Visible">Đã phân quyền</span>
                                    </div>
                                    <ng-template #block>
                                        Chưa phân quyền
                                    </ng-template>
                                </div>
                            </ng-template>
                        </kendo-grid-column>
                        <ng-template kendoGridDetailTemplate
                        let-dataItem>
               <section class="grid-init">
                   <kendo-grid [data]="dataItem.groupPemissions"
                               [height]="300">
                       <kendo-grid-column [title]="'STT' | translate"
                                          [width]="60">
                           <ng-template kendoGridCellTemplate
                                        let-dataItem
                                        let-rowIndex="rowIndex">
                               {{ rowIndex + 1 }}
                           </ng-template>
                       </kendo-grid-column>
                       <kendo-grid-column [columnMenu]="false"
                                          field="label"
                                          [title]="'Vai trò' | translate"
                                          [sortable]="false"> 

                       </kendo-grid-column> 
                   </kendo-grid>
               </section>
           </ng-template>
                    </kendo-grid>
                </div>
            </kendo-splitter-pane>
            <kendo-splitter-pane>
                <div class="grid-wrapper grid-init"
                     [ngStyle]="{ 'height.px': pageHeight }">
                    <kendo-grid [data]="listQuyen"
                                kendoGridSelectBy="id"
                                [selectedKeys]="idsGroupPermission"
                                [style.height]="'100%'">
                        <kendo-grid-checkbox-column [showSelectAll]="true"
                                                    [width]="45"
                                                    [columnMenu]="false"
                                                    class="text-center"
                                                    headerClass="text-center">
                        </kendo-grid-checkbox-column>
                        <kendo-grid-column [title]="'LB.STT' | translate"
                                           [width]="50"
                                           [columnMenu]="false"
                                           headerClass="text-center">
                            <ng-template kendoGridCellTemplate
                                         let-dataItem
                                         let-rowIndex="rowIndex">
                                <div class="text-center">
                                    {{ rowIndex + 1 }}
                                </div>
                            </ng-template>
                        </kendo-grid-column>
                        <kendo-grid-column [columnMenu]="false"
                                           field="itemQuyen"
                                           [title]="'Vai trò' | translate">
                        </kendo-grid-column>
                    </kendo-grid>
                </div>
            </kendo-splitter-pane>
        </kendo-splitter>
    </div>
    <div class="ui-footer-button">
        <school-v2-asc-button (click)="onPermission(false)"
                    [btnClass]="'ui-button-secondary mr-2'"
                    [btnText]="'LB.HRM.DONG_BO' | translate">
        </school-v2-asc-button>
        <school-v2-asc-button (click)="onPermission(true)"
                    [btnClass]="'ui-button-delete'"
                    [btnText]="'LB.HRM.HUY_QUYEN' | translate">
        </school-v2-asc-button>
    </div>
</div>